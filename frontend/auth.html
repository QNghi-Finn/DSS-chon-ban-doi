<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DSS Mate – Đăng ký / Đăng nhập</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body class="page auth-page">
  <main class="card">
    <h1>Đăng ký tài khoản</h1>
    <form id="signupForm" class="grid">
      <div class="col2"><label>Email <input type="email" name="email" required /></label></div>
      <div><label>Mật khẩu <input type="password" name="password" required minlength="6" /></label></div>
      <div><label>Họ tên <input type="text" name="fullName" required /></label></div>
      <div><label>Giới tính
        <select name="gender"><option value="male">Nam</option><option value="female">Nữ</option><option value="other">Khác</option></select>
      </label></div>
      <div><label>Ngày sinh <input type="date" name="birthday" required /></label></div>
      <div><label>Ảnh đại diện (URL) <input type="url" name="avatarUrl" placeholder="/uploads/default_1.jpg" /></label></div>
      <div class="col2">
        <label>Toạ độ (tuỳ chọn)</label>
        <div class="row">
          <input type="number" step="0.0001" name="latitude" placeholder="Lat" />
          <input type="number" step="0.0001" name="longitude" placeholder="Lng" />
          <button type="button" id="btnGeo">Lấy vị trí</button>
        </div>
      </div>
      <div class="col2"><label>Sở thích (phẩy ,)
        <input type="text" name="hobbiesText" placeholder="doc sach, gym, xem phim" /></label>
      </div>
      <div class="col2"><label>Thói quen
        <input type="text" name="habitsText" placeholder="khong hut thuoc, uong ruou it" /></label>
      </div>
      <div class="col2"><label>Quan điểm sống
        <input type="text" name="valuesText" placeholder="gia dinh, trung thuc" /></label>
      </div>
      <div class="row end"><buttom class="primary">Tạo tài khoản</button></div>
    </form>

    <hr/>
    <h2>Đăng nhập</h2>
    <form id="loginForm" class="row">
      <input type="email" name="email" placeholder="email@demo.local" required />
      <input type="password" name="password" placeholder="******" required />
      <buttom>Đăng nhập</buttom>
    </form>
    <p class="muted">Đăng ký/đăng nhập xong sẽ chuyển sang <b><index class="html"></index></b>.</p>
  </main>

  <script src="js/app.js"></script>
  <script>
    // Lấy vị trí
    document.getElementById('btnGeo').onclick = () => {
      if (!navigator.geolocation) return alert('Trình duyệt không hỗ trợ vị trí');
      navigator.geolocation.getCurrentPosition(pos => {
        signupForm.latitude.value  = pos.coords.latitude.toFixed(6);
        signupForm.longitude.value = pos.coords.longitude.toFixed(6);
      }, e => alert('Không lấy được vị trí: ' + e.message), {enableHighAccuracy:true,timeout:8000});
    };

    // Đăng ký
    signupForm.onsubmit = async (e) => {
      e.preventDefault();
      const f = e.target;
      const body = {
        email: f.email.value.trim(),
        password: f.password.value,
        fullName: f.fullName.value.trim(),
        gender: f.gender.value,
        birthday: f.birthday.value,
        latitude: f.latitude.value ? Number(f.latitude.value) : null,
        longitude: f.longitude.value ? Number(f.longitude.value) : null,
        avatarUrl: f.avatarUrl.value || null,
        hobbiesText: f.hobbiesText.value || null,
        habitsText: f.habitsText.value || null,
        valuesText: f.valuesText.value || null
      };
      try { const u = await api.signup(body); storage.setUser(u); location.href='index.html'; }
      catch (err) { notify(err.message || 'Đăng ký thất bại'); }
<div class ="col2">
        <label>Ảnh đại diện </label>
        <div class="row" style="gap 12px;align-item:flex-start">
            <img id="avatarPreview" src="/uploads/default_1.jpg" alt="Ảnh đại diện" style="width:80px;height:80px;object-fit:cover;border-radius:8px;border:1px solid #ccc"/>
            <div class="input" style="flex:1">
                <input type ="hidden" name = "avatarUrl" value = "/uploads/default_1.jpg"/>
                <input id="avatarFile" type="file" accept="image/*"/>
                <span class="help">Chọn ảnh từ máy tính (tối đa 2MB)</span>
            </div>  
        </div>
</div>
};

    // Đăng nhập
    loginForm.onsubmit = async (e) => {
      e.preventDefault();
      try { const u = await api.login({ email: loginForm.email.value.trim(), password: loginForm.password.value });
            storage.setUser(u); location.href='index.html'; }
      catch (err) { notify(err.message || 'Đăng nhập thất bại'); }
    };
  </script>
  <link rel="stylesheet" href="assets/style.css">
<link rel="stylesheet" href="assets/auth.css">

</body>
</html>
